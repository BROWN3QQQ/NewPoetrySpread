# 文件上传

### 功能
* [1.分片上传](#1)
* [2.断点续传](#2)
* [3.秒传](#3)

### [额外说明](#4)

<hr>

### 上传流程
* 上传任务开始时,前端首先要调用**开始上传**的接口(考虑到文件可能比较大,可以不用等文件分完块再调用此接口),并传入一些必需的数据,后端对这些数据进行整理后,返回成功的状态码后才可以上传文件块.要传的数据如下.
```
{
    fileName:xxx,//源文件名
    fileSize:n,//源文件大小,单位最好为KB
    chunkPrefixName:xxx,//文件块的前缀名,我假设文件块的格式为xxx_1,xxx_2.....
    chunkNum:n,//文件应该被拆分为几块
    sourceFileMD5:12312312ab,//源文件的md5值
    beginTime:2018-10-1//开始上传的时间
}
```
后端接收到请求后,会首先判断此文件是否已经被上传过,如果已经被上传过就直接返回 **成功的状态码** ,没有则返回 **准备上传的状态码** ,收到此状态码,前端就可以开始上传文件块.

* 调用上传文件块的接口,要传入以下数据
```
{
    chunk:一个File对象,//文件块,其文件名可能是xxx_1这样的
    chunkMD5:12312312aaa,//文件块的md5值
}
```
为保证每一个文件块都是完整的,对于上传的每一个文件块,后端会校验md5值,如果不匹配会返回错误信息,后端也会返回上传进度的一些信息

* 当最后一个文件块上传成功,后端会将文件合并校验md5值,再返回校验结果,若成功则返回文件所在路径等数据,失败则返回错误信息.

<hr>

### 功能说明

<span id="1">1.分片上传</span>

分片上传是其他功能的基础,根据网上提供的数据,文件片的大小最好为2-5M,***开启的线程不要太多,否则反而会降低上传速度,最好为3个***

<span id="2">2.断点续传</span>

断点续传基于分片上传实现,目的是让上传过程由于某些原因中断时(人为/非人为因素),不必重新上传
后端会提供暂停和恢复两个接口
对于恢复上传接口,调用成功后,后端会给前端返回上传的进度(比如哪些文件块还没有上传)

<span id="3">3.秒传</span>

秒传功能不需要前端做支持,只需要对状态码做判断即可

<hr>

<h3 id="4">额外说明</h3>